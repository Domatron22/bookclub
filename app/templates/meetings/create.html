{% extends "base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-8">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">Schedule a Meeting</h2>
        
        {% if schedule %}
        <div class="mb-6 bg-indigo-50 border border-indigo-200 rounded-lg p-4">
            <p class="text-sm text-indigo-800">
                <i class="fas fa-calendar-alt mr-2"></i>
                <strong>Meeting Pattern:</strong> {{ schedule.recurrence_details }}
            </p>
        </div>
        {% endif %}

        <form method="POST" action="/meetings/create/{{ club.code }}" class="space-y-6">
            <div>
                <label for="title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Meeting Title <span class="text-red-500">*</span>
                </label>
                <input 
                    type="text" 
                    id="title" 
                    name="title" 
                    required
                    value="{% if current_book %}{{ club.name }} - {{ current_book.title }}{% else %}{{ club.name }} Meeting{% endif %}"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                >
            </div>

            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label for="meeting_date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Date <span class="text-red-500">*</span>
                    </label>
                    <input 
                        type="date" 
                        id="meeting_date" 
                        name="meeting_date" 
                        required
                        min="{{ datetime.now().strftime('%Y-%m-%d') }}"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    >
                </div>
                <div>
                    <label for="meeting_time" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Time <span class="text-red-500">*</span>
                    </label>
                    <input 
                        type="time" 
                        id="meeting_time" 
                        name="meeting_time" 
                        required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    >
                </div>
            </div>

            <div>
                <label for="duration_minutes" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Duration
                </label>
                <select 
                    id="duration_minutes" 
                    name="duration_minutes"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                >
                    <option value="60">1 hour</option>
                    <option value="90">1.5 hours</option>
                    <option value="120" {% if schedule and schedule.default_duration_minutes == 120 %}selected{% endif %}>2 hours</option>
                    <option value="180" {% if schedule and schedule.default_duration_minutes == 180 %}selected{% endif %}>3 hours</option>
                    <option value="240">4 hours</option>
                </select>
            </div>

            <div>
                <label for="location" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Location / Virtual Link
                </label>
                <input 
                    type="text" 
                    id="location" 
                    name="location"
                    placeholder="e.g., Coffee Shop on Main St, https://zoom.us/j/123456789"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                >
            </div>

            <div>
                <label for="book_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Book to Discuss (Optional)
                </label>
                <select 
                    id="book_id" 
                    name="book_id"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                >
                    <option value="">General meeting / Social</option>
                    {% if current_book %}
                    <option value="{{ current_book.id }}" selected>{{ current_book.title }} (Currently Reading)</option>
                    {% endif %}
                    {% for book in all_books %}
                        {% if not current_book or book.id != current_book.id %}
                        <option value="{{ book.id }}">{{ book.title }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>

            <div>
                <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Agenda / Notes
                </label>
                <textarea 
                    id="description" 
                    name="description" 
                    rows="4"
                    placeholder="What will you discuss? Any preparation needed?"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                ></textarea>
            </div>

            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                <div class="flex">
                    <i class="fas fa-calendar-plus text-green-500 mt-1 mr-3"></i>
                    <div class="text-sm text-green-800">
                        <p class="font-medium mb-1">What happens next?</p>
                        <p>Members will be able to download a calendar file (.ics) to add this meeting to their personal calendars.</p>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-4">
                <button 
                    type="submit"
                    class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-3 rounded-lg transition duration-150"
                >
                    <i class="fas fa-calendar-check mr-2"></i>Schedule Meeting
                </button>
                <a 
                    href="/meetings/club/{{ club.code }}"
                    class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:text-gray-300 font-semibold px-6 py-3 rounded-lg text-center transition duration-150"
                >
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// Set default date to next occurrence based on pattern
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('meeting_date');
    const timeInput = document.getElementById('meeting_time');
    
    // Set default time to 7:00 PM
    timeInput.value = '19:00';
    
    // Set default date to tomorrow
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    dateInput.value = tomorrow.toISOString().split('T')[0];
});
</script>
{% endblock %}